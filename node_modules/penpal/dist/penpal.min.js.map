{"version":3,"sources":["dist/penpal.js"],"names":["Penpal","MessageType","Resolution","ErrorCode","NativeErrorName","NativeEventType","createDestructor","localName","log","callbacks","destroyed","[object Object]","error","forEach","callback","push","createLogger","debug","args","console","DEFAULT_PORT_BY_PROTOCOL","http:","https:","URL_REGEX","opaqueOriginSchemes","getOriginFromSrc","src","find","scheme","startsWith","location","document","regexResult","exec","protocol","hostname","port","portSuffix","serializeError","name","message","stack","deserializeError","obj","deserializedError","Error","Object","keys","key","connectCallReceiver","info","serializedMethods","local","remote","originForSending","originForReceiving","handleMessageEvent","event","source","data","penpal","Call","origin","callMessage","methodName","id","createPromiseHandler","resolution","returnValue","Reply","Rejected","returnValueIsError","postMessage","err","DataCloneError","errorReplyMessage","Promise","resolve","apply","then","Fulfilled","addEventListener","Message","removeEventListener","generateId","KEY_PATH_DELIMITER","keyPathToSegments","keyPath","split","segmentsToKeyPath","segments","join","createKeyPath","prefix","setAtKeyPath","subject","value","reduce","prevSubject","idx","length","serializeMethods","methods","flattenedMethods","assign","deserializeMethods","connectCallSender","callSender","methodKeyPaths","destroyConnection","createMethodProxy","iframeRemoved","closed","e","code","ConnectionDestroyed","reject","replyMessage","api","handleAckMessageFactory","childOrigin","destructor","destroy","onDestroy","destroyCallReceiver","receiverMethodNames","window","receiverMethodName","methodNames","destroyCallSender","handleSynMessageFactory","synAckMessage","SynAck","CHECK_IFRAME_IN_DOC_INTERVAL","monitorIframeRemoval","iframe","checkIframeInDocIntervalId","setInterval","isConnected","clearInterval","startConnectionTimeout","timeout","timeoutId","undefined","setTimeout","ConnectionTimeout","clearTimeout","validateIframeHasSrcOrSrcDoc","srcdoc","NoIframeSrc","connectToChild","options","handleSynMessage","handleAckMessage","promise","stopConnectionTimeout","handleMessage","contentWindow","Syn","Ack","handleSynAckMessageFactory","parentOrigin","originQualifies","RegExp","test","ackMessage","parent","areGlobalsAccessible","connectToParent","handleSynAckMessage","sendSynMessage","synMessage","parentOriginForSyn","indexForBundle"],"mappings":"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"}